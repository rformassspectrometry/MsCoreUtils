<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="The join_gnps and gnps functions allow to calculate spectra similarity
scores as used in GNPS. The approach matches first
peaks between the two spectra directly using a user-defined ppm and/or
tolerance as well as using a fixed delta m/z (considering the same ppm and
tolerance) that is defined by the difference of the two spectras' precursor
m/z values. For peaks that match multiple peaks in the
other spectrum only the matching peak pair with the higher value/similarity
is considered in the final similarity score calculation. Note that GNPS
similarity scores are calculated only if the two functions are used together.
join_gnps: matches/maps peaks between spectra with the same approach
as in GNPS: peaks are considered matching if a) the
difference in their m/z values is smaller than defined by tolerance
and ppm (this is the same as joinPeaks) and b) the difference of
their m/z adjusted for the difference of the spectras' precursor is
smaller than defined by tolerance and ppm. Based on this definition,
peaks in x can match up to two peaks in y hence returned peak indices
might be duplicated. Note that if one of xPrecursorMz or yPrecursorMz
are NA or if both are the same, the results are the same as with
join(). The function returns a list of two integer vectors with the
indices of the peaks matching peaks in the other spectrum or NA
otherwise.
gnps: calculates the GNPS similarity score on peak matrices' previously
aligned (matched) with join_gnps. For multi-mapping peaks the pair with
the higher similarity are considered in the final score calculation.

"><title>GNPS spectrum similarity scores — gnps • MsCoreUtils</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="GNPS spectrum similarity scores — gnps"><meta property="og:description" content="The join_gnps and gnps functions allow to calculate spectra similarity
scores as used in GNPS. The approach matches first
peaks between the two spectra directly using a user-defined ppm and/or
tolerance as well as using a fixed delta m/z (considering the same ppm and
tolerance) that is defined by the difference of the two spectras' precursor
m/z values. For peaks that match multiple peaks in the
other spectrum only the matching peak pair with the higher value/similarity
is considered in the final similarity score calculation. Note that GNPS
similarity scores are calculated only if the two functions are used together.
join_gnps: matches/maps peaks between spectra with the same approach
as in GNPS: peaks are considered matching if a) the
difference in their m/z values is smaller than defined by tolerance
and ppm (this is the same as joinPeaks) and b) the difference of
their m/z adjusted for the difference of the spectras' precursor is
smaller than defined by tolerance and ppm. Based on this definition,
peaks in x can match up to two peaks in y hence returned peak indices
might be duplicated. Note that if one of xPrecursorMz or yPrecursorMz
are NA or if both are the same, the results are the same as with
join(). The function returns a list of two integer vectors with the
indices of the peaks matching peaks in the other spectrum or NA
otherwise.
gnps: calculates the GNPS similarity score on peak matrices' previously
aligned (matched) with join_gnps. For multi-mapping peaks the pair with
the higher similarity are considered in the final score calculation.

"><meta property="og:image" content="https://rformassspectrometry.github.io/MsCoreUtils/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MsCoreUtils</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.11.6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/MsCoreUtils.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/RforMassSpectrometry/MsCoreUtils/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>GNPS spectrum similarity scores</h1>
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/MsCoreUtils/blob/HEAD/R/gnps.R" class="external-link"><code>R/gnps.R</code></a></small>
      <div class="d-none name"><code>gnps.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The <code>join_gnps</code> and <code>gnps</code> functions allow to calculate spectra similarity
scores as used in <a href="https://gnps.ucsd.edu/" class="external-link">GNPS</a>. The approach matches first
peaks between the two spectra directly using a user-defined ppm and/or
tolerance as well as using a fixed delta m/z (considering the same ppm and
tolerance) that is defined by the difference of the two spectras' precursor
m/z values. For peaks that match multiple peaks in the
other spectrum only the matching peak pair with the higher value/similarity
is considered in the final similarity score calculation. Note that GNPS
similarity scores are calculated only if the two functions are used together.</p><ul><li><p><code>join_gnps</code>: matches/maps peaks between spectra with the same approach
as in GNPS: peaks are considered matching if a) the
difference in their m/z values is smaller than defined by <code>tolerance</code>
and <code>ppm</code> (this is the same as <code>joinPeaks</code>) <strong>and</strong> b) the difference of
their m/z <em>adjusted</em> for the difference of the spectras' precursor is
smaller than defined by <code>tolerance</code> and <code>ppm</code>. Based on this definition,
peaks in <code>x</code> can match up to two peaks in <code>y</code> hence returned peak indices
might be duplicated. Note that if one of <code>xPrecursorMz</code> or <code>yPrecursorMz</code>
are <code>NA</code> or if both are the same, the results are the same as with
<code><a href="matching.html">join()</a></code>. The function returns a <code>list</code> of two <code>integer</code> vectors with the
indices of the peaks matching peaks in the other spectrum or <code>NA</code>
otherwise.</p></li>
<li><p><code>gnps</code>: calculates the GNPS similarity score on peak matrices' previously
<em>aligned</em> (matched) with <code>join_gnps</code>. For multi-mapping peaks the pair with
the higher similarity are considered in the final score calculation.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">gnps</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">join_gnps</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  xPrecursorMz <span class="op">=</span> <span class="cn">NA_real_</span>,</span>
<span>  yPrecursorMz <span class="op">=</span> <span class="cn">NA_real_</span>,</span>
<span>  tolerance <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  ppm <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"outer"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>for <code>join_gnps</code>: <code>numeric</code> with m/z values from a spectrum. For
<code>gnps</code>: <code>matrix</code> with two columns <code>"mz"</code> and <code>"intensity"</code> containing
the peaks <strong>aligned</strong> with peaks in <code>y</code> (with <code>join_gnps</code>).</p></dd>


<dt>y</dt>
<dd><p>for <code>join_gnps</code>: <code>numeric</code> with m/z values from a spectrum. For
<code>gnps</code>: <code>matrix</code> with two columns <code>"mz"</code> and <code>"intensity"</code> containing
the peaks <strong>aligned</strong> with peaks in <code>x</code> (with <code>join_gnps</code>).</p></dd>


<dt>...</dt>
<dd><p>for <code>join_gnps</code>: optional parameters passed to the <code><a href="matching.html">join()</a></code>
function. For <code>gnps</code>: ignored.</p></dd>


<dt>xPrecursorMz</dt>
<dd><p>for <code>join_gnps</code>: <code>numeric(1)</code> with the precursor m/z
of the spectrum <code>x</code>.</p></dd>


<dt>yPrecursorMz</dt>
<dd><p>for <code>join_gnps</code>: <code>numeric(1)</code> with the precursor m/z
of the spectrum <code>y</code>.</p></dd>


<dt>tolerance</dt>
<dd><p>for <code>join_gnps</code>: <code>numeric(1)</code> defining a constant maximal
accepted difference between m/z values of peaks from the two spectra to
be matched/mapped.</p></dd>


<dt>ppm</dt>
<dd><p>for <code>join_gnps</code>: <code>numeric(1)</code> defining a relative, m/z-dependent,
maximal accepted difference between m/z values of peaks from the two
spectra to be matched/mapped.</p></dd>


<dt>type</dt>
<dd><p>for <code>join_gnps</code>: <code>character(1)</code> specifying the type of join that
should be performed. See <code><a href="matching.html">join()</a></code> for details and options. Defaults to
<code>type = "outer"</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>See function definition in the description section.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The implementation of <code>gnps</code> bases on the R code from the publication listed
in the references.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Xing S, Hu Y, Yin Z, Liu M, Tang X, Fang M, Huan T. Retrieving and Utilizing
Hypothetical Neutral Losses from Tandem Mass Spectra for Spectral Similarity
Analysis and Unknown Metabolite Annotation. <em>Anal Chem.</em>
2020 Nov 3;92(21):14476-14483. <a href="https://doi.org/10.1021/acs.analchem.0c02521" class="external-link">doi:10.1021/acs.analchem.0c02521</a>
.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other grouping/matching functions: 
<code><a href="binning.html">bin</a>()</code>,
<code><a href="matching.html">closest</a>()</code></p>
<p>Other distance/similarity functions: 
<code><a href="distance.html">distance</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Johannes Rainer, Michael Witting, based on the code from
Xing <em>et al.</em> (2020).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Define spectra</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">36</span>, <span class="fl">63</span>, <span class="fl">91</span>, <span class="fl">93</span><span class="op">)</span>, intensity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span>, <span class="fl">15</span>, <span class="fl">999</span>, <span class="fl">650</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">12</span>, <span class="fl">50</span>, <span class="fl">63</span>, <span class="fl">105</span><span class="op">)</span>, intensity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">35</span>, <span class="fl">5</span>, <span class="fl">16</span>, <span class="fl">999</span>, <span class="fl">450</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## The precursor m/z</span></span></span>
<span class="r-in"><span><span class="va">pmz_x</span> <span class="op">&lt;-</span> <span class="fl">91</span></span></span>
<span class="r-in"><span><span class="va">pmz_y</span> <span class="op">&lt;-</span> <span class="fl">105</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Plain join identifies only 2 matching peaks</span></span></span>
<span class="r-in"><span><span class="fu"><a href="matching.html">join</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">y</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  1 NA  2 NA  3  4  5 NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  1  2 NA  3  4 NA NA  5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## join_gnps finds 4 matches</span></span></span>
<span class="r-in"><span><span class="fu">join_gnps</span><span class="op">(</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">y</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">pmz_x</span>, <span class="va">pmz_y</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  1  2  2  3  4  4  5 NA NA NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  1 NA  3  4 NA  5 NA  2  3  5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## with one of the two precursor m/z being NA, the result are the same as</span></span></span>
<span class="r-in"><span><span class="co">## with join.</span></span></span>
<span class="r-in"><span><span class="fu">join_gnps</span><span class="op">(</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">y</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">pmz_x</span>, yPrecursorMz <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  1 NA  2 NA  3  4  5 NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  1  2 NA  3  4 NA NA  5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Calculate GNPS similarity score:</span></span></span>
<span class="r-in"><span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu">join_gnps</span><span class="op">(</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">y</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">pmz_x</span>, <span class="va">pmz_y</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">gnps</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">map</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="op">]</span>, <span class="va">y</span><span class="op">[</span><span class="va">map</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.9923501</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by RforMassSpectrometry Package Maintainer, Laurent Gatto, Johannes Rainer, Sebastian Gibb.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer></div>

  

  

  </body></html>

