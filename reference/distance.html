<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Spectra Distance/Similarity Measurements — distance • MsCoreUtils</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Spectra Distance/Similarity Measurements — distance"><meta name="description" content="These functions provide different normalized similariy/distance measurements."><meta property="og:description" content="These functions provide different normalized similariy/distance measurements."><meta property="og:image" content="https://rformassspectrometry.github.io/MsCoreUtils/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MsCoreUtils</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.17.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/MsCoreUtils.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RforMassSpectrometry/MsCoreUtils/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Spectra Distance/Similarity Measurements</h1>
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/MsCoreUtils/blob/strict-r-headers/R/distance.R" class="external-link"><code>R/distance.R</code></a></small>
      <div class="d-none name"><code>distance.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>These functions provide different normalized similariy/distance measurements.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ndotproduct</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, m <span class="op">=</span> <span class="fl">0L</span>, n <span class="op">=</span> <span class="fl">0.5</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dotproduct</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, m <span class="op">=</span> <span class="fl">0L</span>, n <span class="op">=</span> <span class="fl">0.5</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">neuclidean</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, m <span class="op">=</span> <span class="fl">0L</span>, n <span class="op">=</span> <span class="fl">0.5</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">navdist</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, m <span class="op">=</span> <span class="fl">0L</span>, n <span class="op">=</span> <span class="fl">0.5</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">nspectraangle</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, m <span class="op">=</span> <span class="fl">0L</span>, n <span class="op">=</span> <span class="fl">0.5</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p><code>matrix</code>, two-columns e.g. m/z, intensity</p></dd>


<dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p><code>matrix</code>, two-columns e.g. m/z, intensity</p></dd>


<dt id="arg-m">m<a class="anchor" aria-label="anchor" href="#arg-m"></a></dt>
<dd><p><code>numeric</code>, weighting for the first column of <code>x</code> and <code>y</code> (e.g.
"mz"), default: <code>0</code> means don't weight by the first column. For more details
see the <code>ndotproduct</code> details section.</p></dd>


<dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p><code>numeric</code>, weighting for the second column of <code>x</code> and <code>y</code> (e.g.
"intensity"), default: <code>0.5</code> means effectly using <code>sqrt(x[,2])</code> and
<code>sqrt(y[,2])</code>. For more details see the <code>ndotproduct</code> details section.</p></dd>


<dt id="arg-na-rm">na.rm<a class="anchor" aria-label="anchor" href="#arg-na-rm"></a></dt>
<dd><p><code>logical(1)</code>, should <code>NA</code> be removed prior to calculation
(default <code>TRUE</code>).</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>ignored.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>double(1)</code> value between <code>0:1</code>, where <code>0</code> is completely different
and <code>1</code> identically.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>All functions that calculate normalized similarity/distance measurements are
prefixed with a <em>n</em>.</p>
<p><code>ndotproduct</code>: the normalized dot product is described in Stein and Scott
1994 as: \(NDP = \frac{\sum(W_1 W_2)^2}{\sum(W_1)^2 \sum(W_2)^2}\); where
\(W_i = x^m * y^n\), where \(x\) and \(y\) are the m/z and intensity
values, respectively. Please note also that \(NDP = NCos^2\); where NCos
is the cosine value (i.e. the orthodox normalized dot product) of the
intensity vectors as described in Yilmaz et al. 2017. Stein and Scott 1994
empirically determined the optimal exponents as <code>m = 3</code> and <code>n = 0.6</code> by
analyzing ca. 12000 EI-MS data of 8000 organic compounds in the NIST Mass
Spectral Library.
MassBank (Horai et al. 2010) uses <code>m = 2</code> and <code>n = 0.5</code>
for small compounds. In general with increasing values for <code>m</code>,
high m/z values will be taken more into account for similarity calculation.
Especially when working with small molecules, a value <code>m &gt; 0</code> can be set
to give a weight on the m/z values to accommodate that shared fragments
with higher m/z are less likely and will mean that molecules might be more
similar. Increasing <code>n</code> will result in a higher importance of the intensity
values. Most commonly <code>m = 0</code> and <code>n = 0.5</code> are used.</p>
<p><code>neuclidean</code>: the normalized euclidean distance is described in Stein and
Scott 1994 as:
\(NED = (1 + \frac{\sum((W_1 - W_2)^2)}{sum((W_2)^2)})^{-1}\); where
\(W_i = x^m * y^n\), where \(x\) and \(y\) are the m/z and intensity
values, respectively. See the details section about <code>ndotproduct</code> for an
explanation how to set <code>m</code> and <code>n</code>.</p>
<p><code>navdist</code>: the normalized absolute values distance is described in Stein and
Scott 1994 as:
\(NED = (1 + \frac{\sum(|W_1 - W_2|)}{sum((W_2))})^{-1}\); where
\(W_i = x^m * y^n\), where \(x\) and \(y\) are the m/z and intensity
values, respectively. See the details section about <code>ndotproduct</code> for an
explanation how to set <code>m</code> and <code>n</code>.</p>
<p><code>nspectraangle</code>: the normalized spectra angle is described in Toprak et al
2014 as:
\(NSA = 1 - \frac{2*\cos^{-1}(W_1 \cdot W_2)}{\pi}\); where
\(W_i = x^m * y^n\), where \(x\) and \(y\) are the m/z and intensity
values, respectively. The weighting was not originally proposed by Toprak et
al. 2014. See the details section about <code>ndotproduct</code> for an explanation how
to set <code>m</code> and <code>n</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>These methods are implemented as described in Stein and Scott 1994
(<code>navdist</code>, <code>ndotproduct</code>, <code>neuclidean</code>) and Toprak et al. 2014
(<code>nspectraangle</code>) but because there is no reference implementation available
we are unable to guarantee that the results are identical.
Note that the Stein and Scott 1994 normalized dot product method (and by
extension <code>ndotproduct</code>) corresponds to the square of the orthodox
normalized dot product (or cosine distance) used also commonly as spectrum
similarity measure (Yilmaz et al. 2017).
Please see also the corresponding discussion at the github pull request
linked below. If you find any problems or reference implementation please
open an issue at
<a href="https://github.com/rformassspectrometry/MsCoreUtils/issues" class="external-link">https://github.com/rformassspectrometry/MsCoreUtils/issues</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Stein, S. E., and Scott, D. R. (1994).
Optimization and testing of mass spectral library search algorithms for
compound identification.
Journal of the American Society for Mass Spectrometry, 5(9), 859–866.
<a href="https://doi.org/10.1016/1044-0305%2894%2987009-8" class="external-link">doi:10.1016/1044-0305(94)87009-8</a>
.</p>
<p>Yilmaz, S., Vandermarliere, E.,  and Lennart Martens (2017).
Methods to Calculate Spectrum Similarity.
In S. Keerthikumar and S. Mathivanan (eds.), Proteome
Bioinformatics: Methods in Molecular Biology, vol. 1549 (pp. 81).
<a href="https://doi.org/10.1007/978-1-4939-6740-7_7" class="external-link">doi:10.1007/978-1-4939-6740-7_7</a>
.</p>
<p>Horai et al. (2010).
MassBank: a public repository for sharing mass spectral data for life
sciences. Journal of mass spectrometry, 45(7), 703–714.
<a href="https://doi.org/10.1002/jms.1777" class="external-link">doi:10.1002/jms.1777</a>
.</p>
<p>Toprak et al. (2014).
Conserved peptide fragmentation as a benchmarking tool for mass spectrometers
and a discriminating feature for targeted proteomics.
Molecular &amp; Cellular Proteomics : MCP, 13(8), 2056–2071.
<a href="https://doi.org/10.1074/mcp.O113.036475" class="external-link">doi:10.1074/mcp.O113.036475</a>
.</p>
<p>Pull Request for these distance/similarity measurements:
<a href="https://github.com/rformassspectrometry/MsCoreUtils/pull/33" class="external-link">https://github.com/rformassspectrometry/MsCoreUtils/pull/33</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other distance/similarity functions:
<code><a href="gnps.html">gnps</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p><code>navdist</code>, <code>neuclidean</code>, <code>nspectraangle</code>: Sebastian Gibb</p>
<p><code>ndotproduct</code>: Sebastian Gibb and
Thomas Naake, <a href="mailto:thomasnaake@googlemail.com">thomasnaake@googlemail.com</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mz"</span>, <span class="st">"intensity"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mz"</span>, <span class="st">"intensity"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">ndotproduct</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.7660906</span>
<span class="r-in"><span><span class="fu">ndotproduct</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, m <span class="op">=</span> <span class="fl">2</span>, n <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.9074293</span>
<span class="r-in"><span><span class="fu">ndotproduct</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, m <span class="op">=</span> <span class="fl">3</span>, n <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.9127553</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">neuclidean</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.8003406</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">navdist</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.6970151</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">nspectraangle</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.5556013</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by RforMassSpectrometry Package Maintainer, Laurent Gatto, Johannes Rainer, Sebastian Gibb, Philippine Louail.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

